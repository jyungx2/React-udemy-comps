import { createContext, useState, useEffect } from "react";

const NavigationContext = createContext();

const NavigationProvider = ({ children }) => {
  // 1ï¸âƒ£ Initialize current path (immediately know what path the user is visiting)
  // Window.location.pathname = ë¸Œë¼ìš°ì €ì˜ í˜„ì¬ URL ê²½ë¡œ
  // ë ‡ê²Œ ì„¤ì •í•˜ë©´, ì•±ì´ ì²˜ìŒ ë¡œë“œë  ë•Œ ë¸Œë¼ìš°ì € URLê³¼ ìƒíƒœ(currentPath)ê°€ ì²˜ìŒë¶€í„° ë™ê¸°í™”
  const [currentPath, setCurrentPath] = useState(window.location.pathname);
  // navigateì˜ í•¨ìˆ˜ì˜ prop = toê°€ Pathname, pushState ë©”ì†Œë“œì— ì˜í•´ to = window.location.pathnameìœ¼ë¡œ ë™ê¸°í™”

  // 2ï¸âƒ£ ì‚¬ìš©ìê°€ ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸° ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ í˜¸ì¶œ
  // => ë¸Œë¼ìš°ì €ê°€ popstate ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ë©´, ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ setCurrentPath(window.location.pathname)ì„ í˜¸ì¶œí•˜ì—¬ React ìƒíƒœì™€ ë¸Œë¼ìš°ì € URLì„ ë™ê¸°í™”
  // ìš°ë¦¬ê°€ userë¥¼ 'pushState' ë©”ì†Œë“œë¡œ ì¶”ê°€ëœ urlë¡œ ì´ë™ì‹œí‚¤ê³ , ìœ ì €ê°€ ì•ìœ¼ë¡œ/ë’¤ë¡œê°€ê¸° ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ, window ê°ì²´ëŠ” ìë™ìœ¼ë¡œ popstateë¼ëŠ” ì´ë²¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤. -> need to listen to popstate event on the window object and update the current path.
  // ...current pathë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ì´ìœ ëŠ” ë‹¨ì§€ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ì‹œí‚¤ê¸° ìœ„í•¨ì´ë‹¤! (No other reason)
  useEffect(() => {
    const handler = () => {
      setCurrentPath(window.location.pathname);
    };
    window.addEventListener("popstate", handler);

    // NavigationProvider ì»´í¬ë„ŒíŠ¸ê°€ í™”ë©´ì—ì„œ ì‚¬ë¼ì§€ê¸° ì§ì „ì— ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì‚­ì œ (plan for the future)
    return () => {
      window.removeEventListener("popstate", handler);
    };
  }, []);
  // ğŸ’¥ğŸ’¥ğŸ’¥ Tstory í•„ê¸° ğŸ’¥ğŸ’¥ğŸ’¥
  // ğŸ“Œ í—·ê°ˆë¦¬ì§€ ì•ŠëŠ” ë²•
  // - addEventListenerëŠ” "ë‚˜ì¤‘ì— ì´ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•´ë¼"ë¼ê³  ë“±ë¡í•˜ëŠ” ì‘ì—….
  // - Setter functionì€ "ì§€ê¸ˆ ìƒíƒœë¥¼ ë³€ê²½í•´ì„œ ë¦¬ë Œë”ë§í•˜ë¼"ëŠ” ì‹¤í–‰ ì‘ì—….

  // [] ë¹ˆ ë°°ì—´ì€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ 'ë“±ë¡'í•˜ëŠ” ì‘ì—…ì„ ë‹¨ í•œ ë²ˆë§Œ ìˆ˜í–‰í•˜ê²Œ í•©ë‹ˆë‹¤.
  // í•˜ì§€ë§Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìì²´ëŠ” ë¸Œë¼ìš°ì €ì˜ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì— ë“±ë¡ëœ ìƒíƒœë¡œ ìœ ì§€ë˜ê¸° ë•Œë¬¸ì—, ì´í›„ì—ë„ popstate ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ ê³„ì† ì‘ë™í•©ë‹ˆë‹¤.
  // => useEffectëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•˜ê³  ì œê±°í•˜ëŠ” ê´€ë¦¬ ì—­í• ì„ í•©ë‹ˆë‹¤.
  // â“ ë§Œì•½ [] ì—†ì´ ì‹¤í–‰í•˜ë©´?
  // ë§¤ë²ˆ popstate ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë‹¤ì‹œ ë“±ë¡í•˜ê²Œ ë©ë‹ˆë‹¤.
  // ê²°ê³¼ì ìœ¼ë¡œ ì¤‘ë³µëœ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ìŒ“ì´ê²Œ ë˜ì–´ ì„±ëŠ¥ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  // ex) ë’¤ë¡œê°€ê¸°ë¥¼ í•œ ë²ˆ ëˆ„ë¥´ë©´ ë™ì¼í•œ handler í•¨ìˆ˜ê°€ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œë  ìˆ˜ ìˆìŒ.

  // 3ï¸âƒ£ ì‚¬ìš©ìê°€ ë§í¬ë¥¼ í´ë¦­í–ˆì„ ë•Œ í˜¸ì¶œ
  // 1. URLì„ ë³€ê²½í•˜ê¸° ìœ„í•´ pushStateë¥¼ í˜¸ì¶œí•˜ê³ ,
  // 2. React ìƒíƒœ(currentPath)ë„ ì§ì ‘ ì—…ë°ì´íŠ¸í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§
  // pushStateëŠ” ì£¼ì†Œì°½(URL)ë§Œ ë°”ê¾¸ëŠ” ì—­í• , popstateëŠ” ìœ ì €ê°€ ë’¤ë¡œ/ì•ìœ¼ë¡œ ë²„íŠ¼ í´ë¦­í–ˆì„ ë•Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ë¡œì„œ, pushState()ë¡œ urlì„ ë°”ê¿ˆê³¼ ë™ì‹œì— popstateê°€ ë°œìƒí–ˆì„ ë•Œ(addEventListener), setCurrentPath()ë¡œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•´ì£¼ì–´ ì‹¤ì œ í™”ë©´ì— ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§ì´ í•´ì¤˜ì•¼ í•œë‹¤.
  // ì´ë•Œ, pushStateë§Œ í˜¸ì¶œí•˜ë©´ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë˜ì§€ ì•ŠëŠ”ë‹¤. ì¦‰ pushstateê°€ Popstate ì´ë²¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ëŠ” ì•ŠëŠ”ë‹¤!! Reactì—ì„œ ì£¼ì†Œì°½ì— ë”°ë¥¸ UI ë³€ê²½ì€ ìƒíƒœ ë³€í™”ì— ì˜ì¡´í•˜ë¯€ë¡œ, URL ë³€ê²½ê³¼ ë™ì‹œì— React ìƒíƒœ(currentPath)ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ë³€ê²½ëœ í™”ë©´ì„ ë³´ì—¬ì¤„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— setter function ë˜í•œ ë¶ˆëŸ¬ì¤˜ì•¼ í•œë‹¤.
  // ex) to = '/accordion'
  const navigate = (to) => {
    // âœ… 1. ë¸Œë¼ìš°ì €ì˜ historyë¥¼ ì—…ë°ì´íŠ¸
    // ì£¼ì†Œì°½ì˜ Urlì„ ì—…ë°ì´íŠ¸ í•˜ê¸° ìœ„í•´ pushStateë¥¼ í˜¸ì¶œ => ì£¼ì†Œì°½ì„ ë°”ê¿ˆìœ¼ë¡œì¨ ìœ ì € ì†ì„ (ì‹¤ì œë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”í•˜ëŠ” ì—­í•   X)
    // ğŸ’¥ì—¬ê¸°ì„œëŠ” ê¶ê·¹ì ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ì•ˆë˜ê²Œ í•˜ê¸° ìœ„í•´ window.location = ~~ì„ ì•ˆì¼ë‹¤. => ìœ ì €ê°€ ì•/ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ëˆŒë €ì„ ë•Œ popstate ì´ë²¤íŠ¸ê°€ í˜¸ì¶œë˜ëŠ”ë°, ì´ë•Œ í˜¸ì¶œë˜ëŠ” í•¸ë“¤ëŸ¬ê°€ setCurrentPath(window.location.pathname)ì´ë¼ê³  ì„¤ì •í–ˆì„ ë•Œ ìƒˆë¡œê³ ì¹¨ ì•ˆ ë‚˜íƒ€ë‚˜ëŠ” ì´ìœ ê°€ ë°”ë¡œ ì§€ê¸ˆ ì´ ì½”ë“œì²˜ëŸ¼ Pushstateì— ì˜í•´ ì¶”ê°€ëœ urlë¡œ ì´ë™í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸, ê·¸ëƒ¥ Locationë¼ê³  ì¨ì£¼ë©´ ì „ì²´í˜ì´ì§€ê°€ ìƒˆë¡œê³ ì¹¨ë¼ì„œ SPAë¡œì„  âŒâŒ
    // => pushStateë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ìœ ì €ê°€ ì£¼ì†Œì°½ì„ ë°”ê¾¸ë”ë¼ë„ ìƒˆë¡œê³ ì¹¨ ì—†ì´ ìƒíƒœë§Œ ë™ê¸°í™”ë˜ê²Œ í•˜ê¸° ìœ„í•¨.
    window.history.pushState({}, "", to);

    // âœ… 2. React ìƒíƒœ ì—…ë°ì´íŠ¸
    // currentPath stateë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ setter í•¨ìˆ˜ í˜¸ì¶œ => ì»´í¬ë„ŒíŠ¸ ë¦¬ë Œë”
    setCurrentPath(to);

    // * ê²°ë¡ : pushStateë¡œëŠ” URL ë³€ê²½ê³¼ React ìƒíƒœë¥¼ ë™ê¸°í™”í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ setCurrentPathë¡œ React ìƒíƒœë¥¼ ì§ì ‘ ì—…ë°ì´íŠ¸í•´ì•¼ í•œë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ ë’¤ë¡œê°€ê¸°ê°€ ë°œìƒí–ˆì„ ë•Œë„ React ìƒíƒœë¥¼ ë™ê¸°í™”í•´ì•¼ í•˜ë¯€ë¡œ popstate ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.
  };

  return (
    <NavigationContext.Provider value={{ currentPath, navigate }}>
      {children}
    </NavigationContext.Provider>
  );
};

export { NavigationProvider };
export default NavigationContext;
